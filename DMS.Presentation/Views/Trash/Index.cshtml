@model TrashViewModel

<div class="container mt-4">
    <h2 class="mb-4">Trash</h2>

    <div class="mb-3 d-flex w-50">
        <input type="text" id="SearchVal" class="form-control me-2" placeholder="Search..." />
        <button id="searchBtn" class="btn btn-primary">Search</button>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="trashTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="folders-tab" data-bs-toggle="tab"
                    data-bs-target="#folders" type="button" role="tab">
                Folders
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="documents-tab" data-bs-toggle="tab"
                    data-bs-target="#documents" type="button" role="tab">
                Documents
            </button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="trashTabsContent">
        <div class="tab-pane fade show active" id="folders" role="tabpanel">
            <div id="foldersContent" class="text-center p-3">
                <div class="spinner-border" role="status"></div>
            </div>
        </div>
        <div class="tab-pane fade" id="documents" role="tabpanel">
            <div id="documentsContent" class="text-center p-3">
                <div class="spinner-border" role="status"></div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @* <script src="~/lib/jquery/dist/jquery.min.js"></script> *@
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadTrashContent(type, pageNum = 1) {
            let searchVal = $("#SearchVal").val();
            let targetDiv = type === "folders" ? "#foldersContent" : "#documentsContent";

            $.ajax({
                url: `/Trash/Load${type.charAt(0).toUpperCase() + type.slice(1)}`,
                type: "GET",
                data: {
                    searchTerm: searchVal,
                    pageNum: pageNum,
                    pageSize: 3,
                    sortField: "DeletedAt",
                    sortOrder: "desc"
                },
                beforeSend: function () {
                    $(targetDiv).html('<div class="spinner-border" role="status"></div>');
                },
                success: function (result) {
                    $(targetDiv).html(result);
                },
                error: function () {
                    $(targetDiv).html('<div class="text-danger">Failed to load ' + type + '.</div>');
                }
            });
        }

        $(document).ready(function () {
            // Load default tab
            loadTrashContent("folders");

            // Handle tab switch
            $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function (e) {
                const type = $(e.target).attr("data-bs-target").substring(1); // folders or documents
                loadTrashContent(type);
            });

            // Handle search
            $("#searchBtn").click(function () {
                const activeTab = $(".nav-link.active").attr("data-bs-target").substring(1);
                loadTrashContent(activeTab);
            });

            $("#SearchVal").on("input", function () {
                const activeTab = $(".nav-link.active").attr("data-bs-target").substring(1);
                loadTrashContent(activeTab);
            });

            $(document).on("click", ".pagination a", function (e) {
                e.preventDefault();
                const activeTab = $(".nav-link.active").attr("data-bs-target").substring(1);
                const pageNum = $(this).data("pagenum");
                loadTrashContent(activeTab, pageNum);
            });
        });

    </script>
}

