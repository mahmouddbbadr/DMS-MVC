@model TrashViewModel

<div class="container mt-4">
    <h2 class="mb-4">Trash</h2>

    <div class="mb-3 d-flex w-50">
        <input type="text" id="SearchVal" class="form-control me-2 search-input" placeholder="Search..." />
        <button id="searchBtn" class="btn btn-primary search-input">Search</button>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs" id="trashTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="folders-tab" data-bs-toggle="tab"
                    data-bs-target="#folders" type="button" role="tab">
                Folders
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="documents-tab" data-bs-toggle="tab"
                    data-bs-target="#documents" type="button" role="tab">
                Documents
            </button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="trashTabsContent">
        <div class="tab-pane fade show active" id="folders" role="tabpanel">
            <div id="foldersContent" class="text-center p-3">
                <div class="spinner-border" role="status"></div>
            </div>
        </div>
        <div class="tab-pane fade" id="documents" role="tabpanel">
            <div id="documentsContent" class="text-center p-3">
                <div class="spinner-border" role="status"></div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/tabLoader.js"></script>
    <script>
         initTabPage({
             loadFoldersUrl: "/Trash/LoadFolders",
             loadDocumentsUrl: "/Trash/LoadDocuments",
             pageSize: 6,
             sortFieldFolders: "DeletedAt",
             sortFieldDocuments: "DeletedAt"
         });
       /* 
        let sortFieldFol = "DeletedAt";
        let sortOrderFol = "desc";
        let currentPageFol = 1;

        let sortFieldDoc = "DeletedAt";
        let sortOrderDoc = "desc";
        let currentPageDoc = 1;


        function getActiveTab() {
            return $(".nav-link.active").attr("data-bs-target").substring(1); // "folders" or "documents"
        }


        
        function loadTrashFolders() {
            $.ajax({
                url: "/Trash/LoadFolders",
                type: "GET",
                data: {
                    searchTerm: $("#SearchVal").val(),
                    pageNum: currentPageFol,
                    pageSize: 3,
                    sortField: sortFieldFol,
                    sortOrder: sortOrderFol
                },
                beforeSend: () => $("#foldersContent").html('<div class="spinner-border"></div>'),
                success: result => $("#foldersContent").html(result),
                error: () => $("#foldersContent").html('<div class="text-danger">Failed to load folders.</div>')
            });
        }

        function loadTrashDocuments() {
            $.ajax({
                url: "/Trash/LoadDocuments",
                type: "GET",
                data: {
                    searchTerm: $("#SearchVal").val(),
                    pageNum: currentPageDoc,
                    pageSize: 3,
                    sortField: sortFieldDoc,
                    sortOrder: sortOrderDoc
                },
                beforeSend: () => $("#documentsContent").html('<div class="spinner-border"></div>'),
                success: result => $("#documentsContent").html(result),
                error: () => $("#documentsContent").html('<div class="text-danger">Failed to load documents.</div>')
            });
        }

        function refreshActiveTab() {
            getActiveTab() === "folders" ? loadTrashFolders() : loadTrashDocuments();
        }


        
        $(document).ready(function () {
            refreshActiveTab();

           
            $('button[data-bs-toggle="tab"]').on('shown.bs.tab', function () {
                refreshActiveTab();
            });

            
            $("#searchBtn").click(refreshActiveTab);

            
            let typing;
            $("#SearchVal").on("input", function () {
                clearTimeout(typing);
                typing = setTimeout(refreshActiveTab, 400);
            });

            
            $(document).on("click", ".sort-link", function (e) {
                e.preventDefault();
                const field = $(this).data("field");

                if (getActiveTab() === "folders") {
                    sortOrderFol = (sortFieldFol === field && sortOrderFol === "asc") ? "desc" : "asc";
                    sortFieldFol = field;
                    currentPageFol = 1;
                    loadTrashFolders();
                } else {
                    sortOrderDoc = (sortFieldDoc === field && sortOrderDoc === "asc") ? "desc" : "asc";
                    sortFieldDoc = field;
                    currentPageDoc = 1;
                    loadTrashDocuments();
                }
            });

            
            $(document).on("click", ".pagination a", function (e) {
                e.preventDefault();
                if (getActiveTab() === "folders") {
                    currentPageFol = $(this).data("pagenum");
                    loadTrashFolders();
                } else {
                    currentPageDoc = $(this).data("pagenum");
                    loadTrashDocuments();
                }
            });


            
            $(document).on("click", ".restore-button", function (e) {
                e.preventDefault();
                const form = $(this).closest("form");

                Swal.fire({
                    title: "Restore?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonText: "Yes",
                    cancelButtonText: "No"
                }).then(result => {
                    if (result.isConfirmed) {
                        $.post(form.attr("action"), form.serialize())
                            .done(() => setTimeout(() => {
                                            refreshActiveTab();
                                        }, 400))
                            .fail(() => Swal.fire("Error", "Restore failed", "error"));
                    }
                });
            });

            
            $(document).on("click", ".delete-button", function (e) {
                e.preventDefault();
                const form = $(this).closest("form");

                Swal.fire({
                    title: "Delete permanently?",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Delete",
                    confirmButtonColor: "#d33"
                }).then(result => {
                    if (result.isConfirmed) {
                        $.post(form.attr("action"), form.serialize())
                            .done(() => setTimeout(() => {
                                            refreshActiveTab();
                                        }, 400))
                            .fail(() => Swal.fire("Error", "Delete failed", "error"));
                    }
                });
            });
        });
         */

    </script>
}


<link rel="stylesheet" href="~/css/themeIndex.css"/>
