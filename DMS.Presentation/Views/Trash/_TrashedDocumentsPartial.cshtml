@model TrashDocumentsViewModel

@if (Model.TrashedDocuments.Items.Any())
{
    <table class="table table-hover align-middle">
        <thead>
            <tr>
                <th>Name</th>
                <th>Type</th>
                <th>Size (KB)</th>
                <th>Folder</th>
                <th>Deleted At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var d in Model.TrashedDocuments.Items)
            {
                <tr id="doc-row-@d.Id">
                    <td>
                        <a href="~/@d.FilePath" style="text-decoration: underline" target="_blank">
                            @d.Name
                        </a>
                    </td>
                    <td>@d.FileType</td>
                    <td>@(d.Size / 1024)</td>
                    <td>@d.FolderName</td>
                    <td>@d.DeletedAt?.ToString("yyyy-MM-dd")</td>
                    <td>
                        <div class="d-flex flex-wrap align-items-center justify-content-center">
                            <form asp-action="RestoreDocument" asp-controller="Trash" asp-route-id="@d.Id" data-id="@d.Id" method="post" class="m-2 p-0">
                                <button type="submit" class="btn btn-primary btn-sm restore-button">
                                    <i class="fas fa-undo me-1"></i> Restore
                                </button>
                            </form>
                            <form asp-action="DeleteDocument" asp-controller="Trash" asp-route-id="@d.Id" data-id="@d.Id" method="post" class="m-2 p-0">
                                <button type="submit" class="btn btn-danger btn-sm delete-button">
                                    <i class="fas fa-trash-alt me-1"></i> Delete
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            @if (Model.TrashedDocuments.HasPrevious)
            {
                <li class="page-item">
                    <a href="#" class="page-link" data-pagenum="@(Model.TrashedDocuments.CurrentPage - 1)">Previous</a>
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <span class="page-link">Previous</span>
                </li>
            }

            @for (int i = 1; i <= Model.TrashedDocuments.TotalPages; i++)
            {
                if (i == Model.TrashedDocuments.CurrentPage)
                {
                    <li class="page-item active">
                        <span class="page-link">@i</span>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a href="#" class="page-link" data-pagenum="@i">@i</a>
                    </li>
                }
            }

            @if (Model.TrashedDocuments.HasNext)
            {
                <li class="page-item">
                    <a href="#" class="page-link" data-pagenum="@(Model.TrashedDocuments.CurrentPage + 1)">Next</a>
                </li>
            }
            else
            {
                <li class="page-item disabled">
                    <span class="page-link">Next</span>
                </li>
            }
        </ul>
    </nav>
}
else
{
    <p class="text-muted">No trashed documents found.</p>
}








<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    $(document).ready(function() {

        $(".restore-button").click(function(e){

            e.preventDefault();
            const btn = $(this);
            const form = btn.closest('form');
            const docId = form.data('id');

            Swal.fire({
                title: 'Are you sure?',
                text: "This document will be restore.",
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, restore it!'
            }).then((result) => {

                if(result.isConfirmed){

                    $.ajax({
                        url: form.attr("action"),
                        type: 'POST',
                        data: form.serialize(),
                        success: function (response) {
                            if (response.success) {
                                Swal.fire('Restored!', response.message, 'success');
                                $("#doc-row-" + docId).fadeOut(300, function () {
                                    $(this).remove();
                                });
                            } else {
                                Swal.fire('Error!', response.message, 'error');
                            }
                        },
                        error: function (xhr) {
                            let message = 'Something went wrong. Please try again.';
                            if (xhr.responseJSON && xhr.responseJSON.message) {
                                message = xhr.responseJSON.message;
                            } else if (xhr.responseText) {
                                message = xhr.responseText;
                            }

                            Swal.fire('Error!', message, 'error');
                        }
                    });
                }
            })
        });

         $(".delete-button").click(function(e){

            e.preventDefault();
            const btn = $(this);
            const form = btn.closest('form');
            const docId = form.data('id');

            Swal.fire({
                title: 'Are you sure?',
                text: "This document will be deleted forever.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {

                if(result.isConfirmed){

                    $.ajax({
                        url: form.attr("action"),
                        type: 'POST',
                        data: form.serialize(),
                        success: function (response) {
                            if (response.success) {
                                Swal.fire('Deleted!', response.message, 'success');
                                $("#doc-row-" + docId).fadeOut(300, function () {
                                    $(this).remove();
                                });
                            } else {
                                Swal.fire('Error!', response.message, 'error');
                            }
                        },
                        error: function (xhr) {
                            let message = 'Something went wrong. Please try again.';
                            if (xhr.responseJSON && xhr.responseJSON.message) {
                                message = xhr.responseJSON.message;
                            } else if (xhr.responseText) {
                                message = xhr.responseText;
                            }

                            Swal.fire('Error!', message, 'error');
                        }
                    });
                }
            })
        });

        // $(document).on("click", "tr[data-url]", function(e) {
        //     if(!$(e.target).closest("button, a , form").length){
        //         window.open($(this).data("url"), "_self");
        //     }
        // });
    });

</script>
