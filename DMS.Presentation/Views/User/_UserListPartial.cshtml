@model List<DMS.Service.ModelViews.Account.UserOutputViewModel>

@if (Model == null || !Model.Any())
{
    <div class="text-center text-muted py-5">
        <i class="fas fa-info-circle fa-2x mb-3"></i>
        <p>No users found matching the criteria.</p>
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead>
                <tr>
                    <th>Email</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr>
                        <td>@user.EmailAddress</td>
                        <td>@user.FirstName</td>
                        <td>@user.LastName</td>
                        <td>@user.CreatedAt</td>
                        <td>
                            @if (user.IsLocked)
                            {
                                <button class="btn btn-success unblock-btn" data-email="@user.EmailAddress" title="Restore user access">
                                    <i class="fas fa-lock-open"></i> Unblock
                                </button>
                            }
                            else
                            {
                                <button class="btn btn-danger block-btn" data-email="@user.EmailAddress" title="Revoke user access">
                                    <i class="fas fa-lock"></i> Block
                                </button>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">

        
        <li class="page-item @(ViewBag.CurrentPage <= 1 ? "disabled" : "")">
            <a class="page-link" href="#" data-page="@(ViewBag.CurrentPage - 1)" aria-label="Previous">
                <span aria-hidden="true">&laquo; Prev</span>
            </a>
        </li>
        

        @{
            int currentPage = ViewBag.CurrentPage;
            int totalPages = ViewBag.TotalPages;
            int maxPagesToShow = 5;

            int pageStart = Math.Max(1, currentPage - 2);
            int pageEnd = Math.Min(totalPages, currentPage + 2);

            if (currentPage <= 3)
            {
                pageStart = 1;
                pageEnd = Math.Min(totalPages, maxPagesToShow);
            }
            else if (currentPage > totalPages - 3)
            {
                pageStart = Math.Max(1, totalPages - maxPagesToShow + 1);
                pageEnd = totalPages;
            }
        }

        @if (pageStart > 1)
        {
            <li class="page-item @(currentPage == 1 ? "active" : "")">
                <a href="#" class="page-link" data-page="1">1</a>
            </li>
        }

        @if (pageStart > 2)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">...</a>
            </li>
        }

        @for (int i = pageStart; i <= pageEnd; i++)
        {
            <li class="page-item @(currentPage == i ? "active" : "")">
                <a href="#" class="page-link" data-page="@i">@i</a>
            </li>
        }

        @if (pageEnd < totalPages - 1)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">...</a>
            </li>
        }

        @if (pageEnd < totalPages)
        {
            <li class="page-item @(currentPage == totalPages ? "active" : "")">
                <a href="#" class="page-link" data-page="@totalPages">@totalPages</a>
            </li>
        }
        <li class="page-item @(ViewBag.CurrentPage >= ViewBag.TotalPages ? "disabled" : "")">
            <a class="page-link" href="#" data-page="@(ViewBag.CurrentPage + 1)" aria-label="Next">
                <span aria-hidden="true">next &raquo;</span>
            </a>
        </li>
    </ul>
</nav>
}