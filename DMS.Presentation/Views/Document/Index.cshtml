@model DocumentIndexViewModel

<div class="container-fluid mt-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h4 text-primary mb-0">
            <i class="fas fa-folder-open me-2"></i> @Model.FolderName Documents
        </h1>

        <a asp-action="Upload" asp-route-folderId="@Model.FolderId" class="btn btn-success">
            <i class="fas fa-upload me-1"></i> Upload Document
        </a>
    </div>

    <!-- Search -->
    <div class="input-group mb-3 w-50">
        <input type="text" id="SearchVal" class="form-control" value="@Model?.CurrentSearch" placeholder="Search documents..." />
        <button id="searchBtn" class="btn btn-outline-secondary">
            <i class="fas fa-search"></i>
        </button>
    </div>

    <!-- Results -->
    <div id="partial" class="mt-3">
        <div class="text-center text-muted py-5">
            <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
            <p>Loading documents...</p>
        </div>
    </div>
</div>

@section Scripts {
    <script>

        let sortField = "@Model.SortField";
        let sortOrder = "@Model.SortOrder";

        function LoadDocuments(pageNum = 1) {
            let SearchVal = $("#SearchVal").val();

            $.ajax({
                url: "/Document/Index",
                type: "GET",
                data: {
                    folderId: "@Model.FolderId",
                    searchName: SearchVal,
                    pageNum: pageNum,
                    sortField: sortField,
                    sortOrder: sortOrder
                },
                success: function (result) {
                    $("#partial").html(result);
                },
                error: function () {
                    $("#partial").html('<div class="text-danger text-center">Failed to load documents.</div>');
                }
            });
        }

        $(document).ready(function () {
            LoadDocuments();

            $("#SearchVal").on("input", function () {
                LoadDocuments();
            });

            $("#searchBtn").click(function () {
                LoadDocuments();
            });

            $(document).on("click", ".pagination a", function (e) {
                e.preventDefault();
                LoadDocuments($(this).data("pagenum"));
            });
            $(document).on("click", ".sort-link", function (e) {
                e.preventDefault();

                const field = $(this).data("field");
                // const currentOrder = sortField === field && sortOrder === "asc" ? "asc" : "desc";

                // Toggle order if clicking same field again
                sortOrder = (sortField === field && sortOrder === "asc") ? "desc" : "asc";
                sortField = field;

                LoadDocuments();
            });
        });
    </script>
}
